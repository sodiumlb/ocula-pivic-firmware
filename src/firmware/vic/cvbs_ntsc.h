/*
 * Copyright (c) 2025 Sodiumlightbaby
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */

#ifndef _CVBS_NTSC_H_
#define _CVBS_NTSC_H_ 

#include "cvbs.pio.h"
// DAC driving logic is using square wave
//L0, L1 and L2 levels to be asserted on the DAC
//Set L0, L1 and L2 to same level to get DC, or use DC_RUN command
//Delay is used to shift the phase a number of sys cycles between each output to the DAC
//Commands for the PIO program (each word 30 bits):
//    dc_run: Repeate L0 for count periods
//            [29:10]=repeat, [9:5]=L0, [4:0]=dc_run_id
//
//     pixel: CVBS pixel data payload for pixel_run commands
//            [29:25]=L2, [24:20]=delay1, [19:15]=L1, [14:10]=delay0, [9:5] L0, [4:0]=pixel_id
//     burst: Colour burst special. Alternative to doing pixel_run of burst pixels
//            [29:25]=L1, [24:20]=L0, [19:15]=pre_delay(phase), [14:5]=repeat(burst periods), [4:0]=burst_id

#define CVBS_CMD_ID_DC_RUN cvbs_ntsc_offset_cvbs_cmd_dc_run
#define CVBS_CMD_ID_PIXEL cvbs_ntsc_offset_cvbs_cmd_pixel
#define CVBS_CMD_ID_BURST cvbs_ntsc_offset_cvbs_cmd_burst

#define CVBS_CMD_DC_RUN(L0,count) \
        (((count-2) << 10) | ((L0&0x1F) << 5)| CVBS_CMD_ID_DC_RUN)
#define CVBS_CMD_PIXEL(L0,delay0,L1,delay1,L2) \
        (((L2&0x1F) << 25) |  (((delay1-3)&0x1F) << 20) | ((L1&0x1F) << 15) | (((delay0-3)&0x1F) << 10) | ((L0&0x1F) << 5) | CVBS_CMD_ID_PIXEL)
#define CVBS_CMD_BURST(L0,L1,DC,delay,count) \
        (((DC&0x1F) << 25) | ((L1&0x1F) << 20) | ((L0&0x1F) << 15) | (((delay-1)&0x1F) << 10) | (((count-1)&0x1F) << 5) | CVBS_CMD_ID_BURST)

#define CVBS_CMD_BURST_DELAY(cmd,delay) \
        ((cmd & ~(0x1F<<10)) | ((delay-1)&0x1F)<<10)

//Front porch split into two, to allow for change to vertical blanking after first part, if required.
#define NTSC_FRONTPORCH_1 CVBS_CMD_DC_RUN( 9,12)
#define NTSC_FRONTPORCH_2 CVBS_CMD_DC_RUN( 9,4)

#define NTSC_FRONTPORCH  CVBS_CMD_DC_RUN( 9,16)
#define NTSC_HSYNC       CVBS_CMD_DC_RUN( 0,20)
#define NTSC_BREEZEWAY   CVBS_CMD_DC_RUN( 9, 2)
#define NTSC_BACKPORCH   CVBS_CMD_DC_RUN( 9, 2)
#define NTSC_LONG_SYNC_L  CVBS_CMD_DC_RUN( 0,110)
#define NTSC_LONG_SYNC_H  CVBS_CMD_DC_RUN( 9, 20)
#define NTSC_SHORT_SYNC_L CVBS_CMD_DC_RUN( 0, 20)
#define NTSC_SHORT_SYNC_H CVBS_CMD_DC_RUN( 9,110)
#define NTSC_BLANKING     CVBS_CMD_DC_RUN( 9,200)
//Two NTSC burst methodes available CMD_BURST or PIXEL_RUN
//CMD_BURST is more experimental since it runs carrier cycles instead of dot clock cycles
//17 carrier cycles => 19,5 dot clock cycles, syncs up as 20 dot clock cycles
#define NTSC_COLBURST_O     CVBS_CMD_BURST(12, 6, 9, 2,17)
#define NTSC_COLBURST_E     CVBS_CMD_BURST( 6,12, 9, 2,17)

//VIC-20 NTSC dot clock/colour carrier ratio is 4/3.5
//We solve this by using 8 precomputed carrier to pixel
//mappings per color bearing pixel.
//Run versions 0..7 0..7 etc

#define NTSC_BLACK CVBS_CMD_PIXEL(11,22,11,3,11)
#define NTSC_WHITE CVBS_CMD_PIXEL(29,22,29,3,29)

#define NTSC_RED_0 CVBS_CMD_PIXEL(18,14,10,22,18)
#define NTSC_RED_4 CVBS_CMD_PIXEL(10,14,18,22,10)
#define NTSC_RED_1 CVBS_CMD_PIXEL(18,20,10, 3,10)
#define NTSC_RED_5 CVBS_CMD_PIXEL(10,20,18, 3,18)
#define NTSC_RED_2 CVBS_CMD_PIXEL(10, 3,18,22,10)
#define NTSC_RED_6 CVBS_CMD_PIXEL(18, 3,10,22,18)
#define NTSC_RED_3 CVBS_CMD_PIXEL(10, 9,18,22,10)
#define NTSC_RED_7 CVBS_CMD_PIXEL(18, 9,10,22,18)
#define NTSC_CYAN_0 CVBS_CMD_PIXEL(19,14,27,22,19)
#define NTSC_CYAN_4 CVBS_CMD_PIXEL(27,14,19,22,27)
#define NTSC_CYAN_1 CVBS_CMD_PIXEL(19,20,27, 3,27)
#define NTSC_CYAN_5 CVBS_CMD_PIXEL(27,20,19, 3,19)
#define NTSC_CYAN_2 CVBS_CMD_PIXEL(27, 3,19,22,27)
#define NTSC_CYAN_6 CVBS_CMD_PIXEL(19, 3,27,22,19)
#define NTSC_CYAN_3 CVBS_CMD_PIXEL(27, 9,19,22,27)
#define NTSC_CYAN_7 CVBS_CMD_PIXEL(19, 9,27,22,19)
#define NTSC_PURPLE_0 CVBS_CMD_PIXEL(20,16,12,22,20)
#define NTSC_PURPLE_4 CVBS_CMD_PIXEL(12,16,20,22,12)
#define NTSC_PURPLE_1 CVBS_CMD_PIXEL(20,22,12, 3,12)
#define NTSC_PURPLE_5 CVBS_CMD_PIXEL(12,22,20, 3,20)
#define NTSC_PURPLE_2 CVBS_CMD_PIXEL(12, 5,20,22,12)
#define NTSC_PURPLE_6 CVBS_CMD_PIXEL(20, 5,12,22,20)
#define NTSC_PURPLE_3 CVBS_CMD_PIXEL(12,11,20,22,12)
#define NTSC_PURPLE_7 CVBS_CMD_PIXEL(20,11,12,22,20)
#define NTSC_GREEN_0 CVBS_CMD_PIXEL(17,16,25,22,17)
#define NTSC_GREEN_4 CVBS_CMD_PIXEL(25,16,17,22,25)
#define NTSC_GREEN_1 CVBS_CMD_PIXEL(17,22,25, 3,25)
#define NTSC_GREEN_5 CVBS_CMD_PIXEL(25,22,17, 3,17)
#define NTSC_GREEN_2 CVBS_CMD_PIXEL(25, 5,17,22,25)
#define NTSC_GREEN_6 CVBS_CMD_PIXEL(17, 5,25,22,17)
#define NTSC_GREEN_3 CVBS_CMD_PIXEL(25,11,17,22,25)
#define NTSC_GREEN_7 CVBS_CMD_PIXEL(17,11,25,22,17)
#define NTSC_BLUE_0 CVBS_CMD_PIXEL( 9, 8,17,22, 9)
#define NTSC_BLUE_4 CVBS_CMD_PIXEL(17, 8, 9,22,17)
#define NTSC_BLUE_1 CVBS_CMD_PIXEL( 9,14,17,22, 9)
#define NTSC_BLUE_5 CVBS_CMD_PIXEL(17,14, 9,22,17)
#define NTSC_BLUE_2 CVBS_CMD_PIXEL( 9,19,17, 3,17)
#define NTSC_BLUE_6 CVBS_CMD_PIXEL(17,19, 9, 3, 9)
#define NTSC_BLUE_3 CVBS_CMD_PIXEL(17, 3, 9,22,17)
#define NTSC_BLUE_7 CVBS_CMD_PIXEL( 9, 3,17,22, 9)
#define NTSC_YELLOW_0 CVBS_CMD_PIXEL(28, 8,20,22,28)
#define NTSC_YELLOW_4 CVBS_CMD_PIXEL(20, 8,28,22,20)
#define NTSC_YELLOW_1 CVBS_CMD_PIXEL(28,14,20,22,28)
#define NTSC_YELLOW_5 CVBS_CMD_PIXEL(20,14,28,22,20)
#define NTSC_YELLOW_2 CVBS_CMD_PIXEL(28,19,20, 3,20)
#define NTSC_YELLOW_6 CVBS_CMD_PIXEL(20,19,28, 3,28)
#define NTSC_YELLOW_3 CVBS_CMD_PIXEL(20, 3,28,22,20)
#define NTSC_YELLOW_7 CVBS_CMD_PIXEL(28, 3,20,22,28)
#define NTSC_ORANGE_0 CVBS_CMD_PIXEL(21, 9,13,22,21)
#define NTSC_ORANGE_4 CVBS_CMD_PIXEL(13, 9,21,22,13)
#define NTSC_ORANGE_1 CVBS_CMD_PIXEL(21,15,13,22,21)
#define NTSC_ORANGE_5 CVBS_CMD_PIXEL(13,15,21,22,13)
#define NTSC_ORANGE_2 CVBS_CMD_PIXEL(21,20,13, 3,13)
#define NTSC_ORANGE_6 CVBS_CMD_PIXEL(13,20,21, 3,21)
#define NTSC_ORANGE_3 CVBS_CMD_PIXEL(13, 4,21,22,13)
#define NTSC_ORANGE_7 CVBS_CMD_PIXEL(21, 4,13,22,21)
#define NTSC_LORANGE_0 CVBS_CMD_PIXEL(27, 9,19,22,27)
#define NTSC_LORANGE_4 CVBS_CMD_PIXEL(19, 9,27,22,19)
#define NTSC_LORANGE_1 CVBS_CMD_PIXEL(27,15,19,22,27)
#define NTSC_LORANGE_5 CVBS_CMD_PIXEL(19,15,27,22,19)
#define NTSC_LORANGE_2 CVBS_CMD_PIXEL(27,20,19, 3,19)
#define NTSC_LORANGE_6 CVBS_CMD_PIXEL(19,20,27, 3,27)
#define NTSC_LORANGE_3 CVBS_CMD_PIXEL(19, 4,27,22,19)
#define NTSC_LORANGE_7 CVBS_CMD_PIXEL(27, 4,19,22,27)
#define NTSC_PINK_0 CVBS_CMD_PIXEL(25,14,17,22,25)
#define NTSC_PINK_4 CVBS_CMD_PIXEL(17,14,25,22,17)
#define NTSC_PINK_1 CVBS_CMD_PIXEL(25,20,17, 3,17)
#define NTSC_PINK_5 CVBS_CMD_PIXEL(17,20,25, 3,25)
#define NTSC_PINK_2 CVBS_CMD_PIXEL(17, 3,25,22,17)
#define NTSC_PINK_6 CVBS_CMD_PIXEL(25, 3,17,22,25)
#define NTSC_PINK_3 CVBS_CMD_PIXEL(17, 9,25,22,17)
#define NTSC_PINK_7 CVBS_CMD_PIXEL(25, 9,17,22,25)
#define NTSC_LCYAN_0 CVBS_CMD_PIXEL(22,14,30,22,22)
#define NTSC_LCYAN_4 CVBS_CMD_PIXEL(30,14,22,22,30)
#define NTSC_LCYAN_1 CVBS_CMD_PIXEL(22,20,30, 3,30)
#define NTSC_LCYAN_5 CVBS_CMD_PIXEL(30,20,22, 3,22)
#define NTSC_LCYAN_2 CVBS_CMD_PIXEL(30, 3,22,22,30)
#define NTSC_LCYAN_6 CVBS_CMD_PIXEL(22, 3,30,22,22)
#define NTSC_LCYAN_3 CVBS_CMD_PIXEL(30, 9,22,22,30)
#define NTSC_LCYAN_7 CVBS_CMD_PIXEL(22, 9,30,22,22)
#define NTSC_LPURPLE_0 CVBS_CMD_PIXEL(27,16,19,22,27)
#define NTSC_LPURPLE_4 CVBS_CMD_PIXEL(19,16,27,22,19)
#define NTSC_LPURPLE_1 CVBS_CMD_PIXEL(27,22,19, 3,19)
#define NTSC_LPURPLE_5 CVBS_CMD_PIXEL(19,22,27, 3,27)
#define NTSC_LPURPLE_2 CVBS_CMD_PIXEL(19, 5,27,22,19)
#define NTSC_LPURPLE_6 CVBS_CMD_PIXEL(27, 5,19,22,27)
#define NTSC_LPURPLE_3 CVBS_CMD_PIXEL(19,11,27,22,19)
#define NTSC_LPURPLE_7 CVBS_CMD_PIXEL(27,11,19,22,27)
#define NTSC_LGREEN_0 CVBS_CMD_PIXEL(21,16,29,22,21)
#define NTSC_LGREEN_4 CVBS_CMD_PIXEL(29,16,21,22,29)
#define NTSC_LGREEN_1 CVBS_CMD_PIXEL(21,22,29, 3,29)
#define NTSC_LGREEN_5 CVBS_CMD_PIXEL(29,22,21, 3,21)
#define NTSC_LGREEN_2 CVBS_CMD_PIXEL(29, 5,21,22,29)
#define NTSC_LGREEN_6 CVBS_CMD_PIXEL(21, 5,29,22,21)
#define NTSC_LGREEN_3 CVBS_CMD_PIXEL(29,11,21,22,29)
#define NTSC_LGREEN_7 CVBS_CMD_PIXEL(21,11,29,22,21)
#define NTSC_LBLUE_0 CVBS_CMD_PIXEL(16, 8,24,22,16)
#define NTSC_LBLUE_4 CVBS_CMD_PIXEL(24, 8,16,22,24)
#define NTSC_LBLUE_1 CVBS_CMD_PIXEL(16,14,24,22,16)
#define NTSC_LBLUE_5 CVBS_CMD_PIXEL(24,14,16,22,24)
#define NTSC_LBLUE_2 CVBS_CMD_PIXEL(16,19,24, 3,24)
#define NTSC_LBLUE_6 CVBS_CMD_PIXEL(24,19,16, 3,16)
#define NTSC_LBLUE_3 CVBS_CMD_PIXEL(24, 3,16,22,24)
#define NTSC_LBLUE_7 CVBS_CMD_PIXEL(15, 3,24,22,16)
#define NTSC_LYELLOW_0 CVBS_CMD_PIXEL(31, 8,23,22,31)
#define NTSC_LYELLOW_4 CVBS_CMD_PIXEL(23, 8,31,22,23)
#define NTSC_LYELLOW_1 CVBS_CMD_PIXEL(31,14,23,22,31)
#define NTSC_LYELLOW_5 CVBS_CMD_PIXEL(23,14,31,22,23)
#define NTSC_LYELLOW_2 CVBS_CMD_PIXEL(31,19,23, 3,23)
#define NTSC_LYELLOW_6 CVBS_CMD_PIXEL(23,19,31, 3,31)
#define NTSC_LYELLOW_3 CVBS_CMD_PIXEL(23, 3,31,22,23)
#define NTSC_LYELLOW_7 CVBS_CMD_PIXEL(31, 3,23,22,31)

#endif /* _CVBS_NTSC_H_ */
 
